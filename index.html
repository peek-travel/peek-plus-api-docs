
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Peek Plus API</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen-a1ce949a.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print-bccf8c07.css" rel="stylesheet" media="print" />
      <script src="javascripts/all-c5541673.js"></script>
  </head>

  <body class="index" data-languages="[&quot;graphql&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar-cad8cdcb.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo-5d0c5f50.png" class="logo" alt="Logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="graphql">graphql</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="Introduction">Introduction</a>
          </li>
          <li>
            <a href="#why-gql" class="toc-h1 toc-link" data-title="Why GQL?">Why GQL?</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#smaller-customizable-payloads" class="toc-h2 toc-link" data-title="Smaller, Customizable Payloads">Smaller, Customizable Payloads</a>
                  </li>
                  <li>
                    <a href="#strongly-typed" class="toc-h2 toc-link" data-title="Strongly Typed">Strongly Typed</a>
                  </li>
                  <li>
                    <a href="#self-documenting" class="toc-h2 toc-link" data-title="Self Documenting">Self Documenting</a>
                  </li>
                  <li>
                    <a href="#further-reading" class="toc-h2 toc-link" data-title="Further Reading">Further Reading</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#authentication" class="toc-h1 toc-link" data-title="Authentication">Authentication</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#jwt" class="toc-h2 toc-link" data-title="JWT">JWT</a>
                  </li>
                  <li>
                    <a href="#add-token-as-header" class="toc-h2 toc-link" data-title="Add Token as Header">Add Token as Header</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#idempotency" class="toc-h1 toc-link" data-title="Idempotency">Idempotency</a>
          </li>
          <li>
            <a href="#versioning" class="toc-h1 toc-link" data-title="Versioning">Versioning</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#backwards-compatible-changes" class="toc-h2 toc-link" data-title="Backwards Compatible Changes">Backwards Compatible Changes</a>
                  </li>
                  <li>
                    <a href="#breaking-changes" class="toc-h2 toc-link" data-title="Breaking Changes">Breaking Changes</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#queries" class="toc-h1 toc-link" data-title="Queries">Queries</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#activities" class="toc-h2 toc-link" data-title="Activities">Activities</a>
                  </li>
                  <li>
                    <a href="#availability" class="toc-h2 toc-link" data-title="Availability">Availability</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#mutations" class="toc-h1 toc-link" data-title="Mutations">Mutations</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#createquote" class="toc-h2 toc-link" data-title="CreateQuote">CreateQuote</a>
                  </li>
                  <li>
                    <a href="#updatequote" class="toc-h2 toc-link" data-title="UpdateQuote">UpdateQuote</a>
                  </li>
                  <li>
                    <a href="#createorder" class="toc-h2 toc-link" data-title="CreateOrder">CreateOrder</a>
                  </li>
              </ul>
          </li>
      </ul>
        <ul class="toc-footer">
            <li><a href='https://www.peek.com/developers'>Sign Up</a></li>
            <li><a href='https://github.com/peek-travel/peek-plus-api-docs'>Contribute</a></li>
            <li><a href='https://github.com/lord/slate'>ðŸ™Œ</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='introduction'>Introduction</h1>
<p>Welcome to the PeekPlus GraphQL API!</p>

<p>You can use our API to access thousands upon thousands of things to do, curated by us.</p>

<p>With the PeekPlus API you can</p>

<ul>
<li>Search For Activities</li>
<li>Check Real Time Availability</li>
<li>Create Quotes / Orders</li>
</ul>
<div class="highlight"><pre class="highlight plaintext"><code>ðŸ’¥ðŸ’¥  One Endpoint  ðŸ’¥ðŸ’¥
https://api.peek.com/gql
</code></pre></div><h1 id='why-gql'>Why GQL?</h1>
<p>We chose Graphql over some older standards because it is the <strong>best tool</strong> for us to expose our data to you in an <em>elegant</em>, <em>self-documenting</em>, <em>flexible</em> and <em>performant</em> way.</p>

<p>If you are new to Graphql, we are confident you will never think about APIs the same way again.</p>

<p>If you are already familiar with Graphql, we can feel your excitement; we&#39;re right there with you.</p>
<h2 id='smaller-customizable-payloads'>Smaller, Customizable Payloads</h2>
<p>In a traditional &quot;here is the endpoint to return activities&quot; scenario, the original creators would include everything they felt &quot;reasonable&quot; - maybe something like:</p>

<ul>
<li>name</li>
<li>description</li>
<li>image</li>
</ul>

<p>Then someone comes along and makes a really compelling case for exposing the location. So, for them, we add a few new fields for <code>lat</code> and <code>lng</code>.</p>

<p>Then someone comes along later and asks for review meta data because they want to expose it. Reasonable. So again we go and add a few new fields for the <code>count</code> and <code>average_rating</code>.</p>

<p>Then someone comes along and says they want a field that is actually pretty heavy. They are aware that it is heavier but are comfortable only asking for a few activities. So we add it.</p>

<p>Now the original users who just want the <code>name</code> and <code>description</code> are telling us the api is too slow; uh oh they were querying for a ton of activities and that heavy field is now a problem. So we hack together some query params where you can white-list fields:</p>

<p><code>http://example.com/activities?fields=name,description...</code></p>

<p>Great, but when you ask for activities, we actually want to also be able to get the tickets.. so now you are all</p>

<p><code>http://example.com/activities?fields=name,description,tickets.name...</code></p>

<p>..and everything starts to feel really dirty.</p>

<p>With GraphQL, we simply expose our object graph:</p>

<ul>
<li>Activity

<ul>
<li>Name</li>
<li>Description</li>
<li>Tickets</li>
</ul></li>
<li>Ticket

<ul>
<li>Name</li>
</ul></li>
</ul>

<p>And you, the owner of your experience, ask for what you need and we return it to you. Simple as that. Furthermore, if you find your self wanting 4 or 5 different things, you can ask for them all at once saving many round trips to the server.</p>

<p>Wins. All. Around.</p>
<h2 id='strongly-typed'>Strongly Typed</h2>
<p>With a traditional REST API, you find yourself stringing together complex query params to filter content:</p>

<p><code>http://example.com/activities?sort=price&amp;filter[state]=NY...</code></p>

<p>Inevitably the question comes in &quot;what are possible values for SORT&quot;, or &quot;what should I use for the STATE?&quot;. In those traditional APIs, you&#39;d be digging for the email that linked to the docs or some light guessing and checking. It is then up the api server to gracefully handle all possible mistakes to get you a reasonable error message if you deviate from what&#39;s expected. This is a lot of work for both parties, and is error prone.</p>

<p>With Graphql, every query is <strong>Strongly Typed</strong> - you get immediate feedback of what the value can be, and if you deviate from it, the request doesn&#39;t even make it to our application logic; you are immediately given a good error explaining your mistake.</p>

<p><img src="https://user-images.githubusercontent.com/1004167/73576938-893fcc00-4430-11ea-9045-66020005fae8.png" alt="image" /></p>
<h2 id='self-documenting'>Self Documenting</h2>
<p>Piggy-backing on the strongly type point from above, Graphql was written, from the ground up, to be easy to &quot;introspect&quot;. There are a host of great free clients out there; we are big fans of <a href="https://insomnia.rest/graphql/">https://insomnia.rest/graphql/</a> - simply by downloading that client and pointing to our sandbox url, you have every query, field and mutation documented. We find crafting your queries there and then moving them into your app is a solid way to work.</p>

<p><img src="https://user-images.githubusercontent.com/1004167/73577149-010df680-4431-11ea-8cb9-ccfd998d6ca7.png" alt="image" /></p>
<h2 id='further-reading'>Further Reading</h2>
<ul>
<li><a href="https://graphql.org/learn/queries/">https://graphql.org/learn/queries/</a></li>
</ul>
<h1 id='authentication'>Authentication</h1><h2 id='jwt'>JWT</h2>
<p>When you are granted access to the API, you will be given an Api Key (&quot;your-api-key&quot;) and a Secret (&quot;your-secret&quot;). Every request you make will require you to create a JWT that includes your API Key in the <code>sub</code> field and a unique request ID in the <code>reqid</code> field, which is then signed w/ your secret:</p>

<p><code>{&quot;sub&quot;: &quot;your-api-key&quot;, &quot;reqid&quot;: &quot;unique-request-id&quot;}</code></p>

<p>If you&#39;re new to JWTs, <a href="https://jwt.io/">https://jwt.io/</a> is a GREAT place to start:</p>

<p><img src="https://user-images.githubusercontent.com/1004167/73561655-38b77700-440e-11ea-8ea7-f00068dc1750.png" alt="image" /></p>
<div class="highlight"><pre class="highlight elixir tab-elixir"><code><span class="k">defmodule</span> <span class="no">Token</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Joken</span><span class="o">.</span><span class="no">Config</span>

  <span class="nv">@doc</span> <span class="sd">"""
  Given a unique request ID, return a signed token.
  """</span>
  <span class="k">def</span> <span class="n">for_request_id</span><span class="p">(</span><span class="n">request_id</span><span class="p">)</span> <span class="k">do</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">claims</span><span class="p">}</span> <span class="o">=</span>
      <span class="no">Token</span><span class="o">.</span><span class="n">generate_claims</span><span class="p">(%{</span>
        <span class="sd">"</span><span class="s2">sub"</span> <span class="o">=&gt;</span> <span class="sd">"</span><span class="s2">your-api-key"</span><span class="p">,</span>
        <span class="sd">"</span><span class="s2">reqid"</span> <span class="o">=&gt;</span> <span class="n">request_id</span>
      <span class="p">})</span>

    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">_claims</span><span class="p">}</span> <span class="o">=</span> <span class="n">encode_and_sign</span><span class="p">(</span><span class="n">claims</span><span class="p">,</span> <span class="n">signer</span><span class="p">())</span>

    <span class="n">token</span>
  <span class="k">end</span>

  <span class="k">defp</span> <span class="n">signer</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="no">Joken</span><span class="o">.</span><span class="no">Signer</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="sd">"</span><span class="s2">HS256"</span><span class="p">,</span> <span class="sd">"</span><span class="s2">your-secret"</span><span class="p">)</span>
<span class="k">end</span>

<span class="no">Token</span><span class="o">.</span><span class="n">for_request_id</span><span class="p">(</span><span class="sd">"</span><span class="s2">unique-request-id"</span><span class="p">)</span>
</code></pre></div>
<p>The reason we chose JWT is because there exists a client for (nearly?) every language imaginable. No need to write your own logic, just find the library (all listed on the above site) for your language and it should be straightforward from there.</p>

<p>We are an Elixir Shop (don&#39;t even get me started), so our library of choice is called <code>Joken</code>; on the right is how you might choose to implement the above w/ <code>Joken</code>.</p>
<h2 id='add-token-as-header'>Add Token as Header</h2>
<p>The Token you generated above has to be included in the header for every request:</p>

<p><code>Authorization: Bearer TOKEN</code></p>

<aside class="info">Replace TOKEN with your own token</aside>

<aside class="warning">Please keep your API credentials secret. Do not put it in client-side code.</aside>
<h1 id='idempotency'>Idempotency</h1>
<p>Since every request that you make must contain a unique request id inside the signed token, if you make a second request with the same request id we will assume this you replaying a request and will return the original response.</p>

<aside class="warning">
If you erroneously use the same request id for a request with a different request body, this will return an error.
</aside>
<h1 id='versioning'>Versioning</h1>
<p>Another advantage of GQL is that the need for versioning largely goes away; the schema evolves overtime without the need for strict versions.</p>
<h3 id='backwards-compatible-changes'>Backwards Compatible Changes</h3>
<p>99% of our GQL changes are backwards compatible; they involve deprecating a field which just results in a warning if used but doesn&#39;t stop working. Or it&#39;s a new field altogether and since you aren&#39;t asking for it, it doesn&#39;t affect you.</p>

<p><img src="https://user-images.githubusercontent.com/1004167/73579222-af686a80-4436-11ea-90ab-ab8e9a242606.png" alt="image" /></p>
<h3 id='breaking-changes'>Breaking Changes</h3>
<p>We do everything possible to avoid these, and at the time of writing this, see no reason why we&#39;ll ever have them. That said, let&#39;s say a field has been deprecated for 6 months and an integration continues to use it even after being told that it&#39;s going away, eventually that field will have to go, which yes, would be a breaking change. Beyond this we don&#39;t see a reason why we can&#39;t evolve this API through clean deprecations.</p>
<h1 id='queries'>Queries</h1>
<p>As mentioned earlier, the source of truth for what&#39;s available can be browsed from directly inside your GQL Client. Duplicating and maintaining the spec would defeat the advantages of GQL. With that in mind, this section will be very high level to help shape your understanding of what&#39;s available, <strong>not</strong> the source of truth.</p>
<h2 id='activities'>Activities</h2>
<p>The <code>Activities</code> query is the most powerful query in the API in that it can be used for two major use-cases:</p>

<ol>
<li>Provide activities based on filters/sorting (location / price / keywords / etc). This could power real-time experiences where you need very specific activities for a given use-case.</li>
<li>You want to &quot;ingest&quot; our entire inventory through crawling every page of the results, pulling every field that is of importance to you.</li>
</ol>
<div class="highlight"><pre class="highlight graphql tab-graphql"><code><span class="k">query</span><span class="w"> </span><span class="n">Activities</span><span class="p">(</span><span class="nv">$filter</span><span class="p">:</span><span class="w"> </span><span class="n">ActivitiesFilter</span><span class="p">!,</span><span class="w"> </span><span class="nv">$pagination</span><span class="p">:</span><span class="w"> </span><span class="n">Pagination</span><span class="p">!,</span><span class="w"> </span><span class="nv">$sort</span><span class="p">:</span><span class="w"> </span><span class="n">ActivitySort</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">activities</span><span class="p">(</span><span class="n">filter</span><span class="p">:</span><span class="w"> </span><span class="nv">$filter</span><span class="p">,</span><span class="w"> </span><span class="n">pagination</span><span class="p">:</span><span class="w"> </span><span class="nv">$pagination</span><span class="p">,</span><span class="w"> </span><span class="n">sort</span><span class="p">:</span><span class="w"> </span><span class="nv">$sort</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">entries</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">name</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>For the purposes of this example, let&#39;s say you just need each Activity&#39;s <code>name</code>. Your query for both use-cases would be identical.</p>

<p>In the two examples above, the main difference is what you pass in for variables. For a very specific query you&#39;d pass in filters and sort values based on your desires. For crawling the whole inventory, you&#39;d also likely not include any filters and you&#39;d ask for <code>totalPages</code> so you can crawl through all of them, etc.</p>

<blockquote>
<p>Example Response:</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="p">{</span>
  <span class="s2">"activities"</span><span class="p">:</span> <span class="p">[{</span>
    <span class="s2">"entries"</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span> <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Activity 1"</span> <span class="p">},</span>
      <span class="p">{</span> <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Activity 2"</span> <span class="p">},</span>
    <span class="p">]</span>
  <span class="p">}]</span>
<span class="p">}</span>
</code></pre></div><h2 id='availability'>Availability</h2>
<p>This query is split into two individual queries;</p>

<ol>
<li>Get high-level cachable dates to get an idea of, roughly speaking, when a given activity is available.</li>
<li>Given a specific set of tickets (1x Adult, 2x Child) for an activity on a specific date, what times are available.</li>
</ol>

<p>(coming soon)</p>
<h1 id='mutations'>Mutations</h1><h2 id='createquote'>CreateQuote</h2>
<p>A quote holds a set of inventory while locking in a price. You can think of a quote as a draft order or a reservation.</p>

<p>(more on this coming soon)</p>
<h2 id='updatequote'>UpdateQuote</h2>
<p>It is useful to update a quote as a customer changes the tickets, switches their desired time, etc.</p>

<p>(more on this coming soon)</p>
<h2 id='createorder'>CreateOrder</h2>
<p>This will create an order out of a given quote. At this point, you order is submitted.</p>

<p>(more on this coming soon)</p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="graphql">graphql</a>
          </div>
      </div>
    </div>
  </body>
</html>
